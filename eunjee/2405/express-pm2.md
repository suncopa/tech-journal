### 개요

> 구구절절 설명하기 보다 비슷한 문제를 겪고 있는 분들이 빠르게 문제 해결에 도달할 수 있도록 바로 해결책 제공

- 들어가며 (서론, 트러블슈팅 상황설명)
  - CSAP(클라우드 서비스 보안인증제도) 취약점 진단 결과 x-powered-by 헤더 설정 필요
  - 클라이언트 사이드 앱 자체적으로는 설정할 수 없는 부분이라 웹 서버에서 설정해주거나 서버가 필요했음
  - 웹 서버인 nginx에서 설정해줄 수 있지만, 클라우드 제품은 쿠버네티스 환경으로 nginx를 사용하지 않고 있었음
  - pm2로 리액트 앱을 서빙하고 있었는데, 여기에 express 서버를 사용해 리액트 앱을 호스팅하는 방식으로 해결하기로 함
- 취약점
  - x-powered-by 헤더 설정 : 이에 대한 설명
  - production으로 배포
  - 로그 파일 권한 설정
- 개발 목표
  - express 서버를 통해 리액트 앱을 호스팅하고 pm2로 띄우기
- 리액트 앱의 정적 파일을 서빙하는 express 서버 만들기
  - x-powered-by 헤더 설정
- Dockerfile 권한 설정


# 들어가며

바야흐로 일주일 전, 바쁘게 신규 기능을 개발하고 있는 와중에 뜬금 없지만 아주 중요한 태스크가 하나 제게 주어졌습니다. 현업에 계신 분들은 와 닿으실 수도 있겠는데요. 회사 제품에 국가 공인 인증을 받기 위한 작업으로서 회사 밥벌이에 아주 지대한 영향을 미치는 태스크였습니다.

저는 어려운 기술 문제를 해결하는 데에 큰 재미를 느끼는 편이라 데브옵스에 관심이 있습니다. 경험 상 데브옵스쪽 업무를 해봤을 때 평소에 하는 리액트 개발보다 훨씬 난이도가 높다고 느꼈습니다. 시간이 얼마나 걸리든 끈질기게 물고 늘어져 그 문제를 해결하고 나면 그 성취감은 더욱 달콤하더라구요. (이것도 일종의 도파민 중독 아닐까...)

오늘 설명할 태스크도 데브옵스와 관련이 있었는데요. 단순히 리액트 코드를 수정하면 해결되는 문제가 아니라, 배포 파이프라인을 변경하고 Dockerfile까지 직접 수정해야 했습니다. 이 글에서는 읽고 계신 분들의 편의를 위해 해결책을 미사여구 없이 빠르게 전달하겠지만, 실제로는 문제 정의부터 최종 해결까지 만 4일 정도의 시간이 걸렸습니다.

기존에 블로그 글을 쓸 때는 해결 과정을 꼼꼼히 기록하려고 하는 편이었는데, 오늘은 정보성 글로서 구구절절 과정 설명을 최소화해보도록 하겠습니다.

# 배경 설명

제가 해결해야 하는 문제는 프론트엔드 앱에서 발견된 취약점을 보완하는 것이었습니다. 

1. x-powered-by 헤더 설정 해제
2. node 프로세스 권한 제한

### 1) x-powered-by 헤더

> x-powered-by 헤더란?

웹 서버나 애플리케이션 서버가 클라이언트에게 응답할 때, 해당 서버가 어떤 기술이나 프레임워크를 사용했는지를 알려주는 HTTP 응답 헤더입니다.

> x-powered-by 헤더와 프론트엔드 앱(리액트 앱) 간의 무슨 관계일까?

사실 엄밀하게는 리액트 어플리케이션과 x-powered-by 헤더 간에는 상관관계가 직접적으로 없습니다. 왜냐하면 리액트 어플리케이션은 클라이언트 사이드 어플리케이션으로서 HTTP 헤더 설정을 직접적으로 할 수 없기 때문이죠. x-powered-by 헤더는 이 리액트 어플리케이션을 이를 제공하고 있는 웹 서버에 의해 결정됩니다. (nginx, apache 등 웹 서버의 설정을 통해 변경할 수 있습니다.)

하지만 nginx와 같은 웹 서버를 두고 있지 않기 때문에 이를 통한 해결 방법은 불가능했습니다.

#### 해결책

> 리액트 어플리케이션을 서빙하는 express 서버를 통해 x-powered-by 헤더 설정을 하자!

기존에는 serve로 pm2를 통해 정적 리소스를 서빙하고 있었는데요. serve 대신 간단한 express 서버를 통해 정적 리소스를 서빙하도록 하고, 이 express 서버를 통해 HTTP 헤더 등의 서버 로직을 추가하기로 결정했습니다.

*serve : 별도의 서버 코드 작성 없이 JavaScript와 Node.js 환경에서 사용되는 경량의 정적 파일 서버 패키지

### 2) node 프로세스 권한 제한 및 실행 모드 설정

#### 해결책